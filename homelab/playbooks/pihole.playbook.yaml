---
- name: Install DNS server with Pihole and Cloudflared
  hosts:
    - dns
    - dns2
  gather_facts: true
  become: true
  roles:
    - name: pihole
      vars:
        project: '{{ lookup("env", "PROJECT_NAME") }}'
        dns_hosts:
          - 192.168.10.1 router
          - 192.168.10.253 pve
          - 192.168.10.253 pve2
          - 192.168.10.2 truenas-srv.{{ domain }}
          - 192.168.10.3 pbs-srv.{{ domain }}
          - 192.168.10.5 {{ proxy_host }}
          - 192.168.10.100 principal-dns.{{ domain }}
          - 192.168.10.200 secondary-dns.{{ domain }}
        cnameRecords:
          - truenas.{{ domain }},{{ proxy_host }}
          - nas.{{ domain }},{{ proxy_host }}
          - pbs.{{ domain }},{{ proxy_host }}
          - dns.{{ domain }},{{ proxy_host }}
          - dns2.{{ domain }},{{ proxy_host }}
          - pve.{{ domain }},{{ proxy_host }}
          - pve2.{{ domain }},{{ proxy_host }}
          - n8n.{{ domain }},{{ proxy_host }}
