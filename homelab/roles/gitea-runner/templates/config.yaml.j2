# Gitea Actions Runner Configuration
# Generated by Ansible for binary installation

log:
  # The level of logging, can be trace, debug, info, warn, error, fatal
  level: {{ gitea_runner_log_level | default('info') }}

runner:
  # Where to store the registration result.
  file: {{ gitea_runner_data_file }}
  # Execute how many tasks concurrently at the same time.
  capacity: {{ gitea_runner_capacity | default(1) }}
  # Extra environment variables to run jobs.
  envs:
    PATH: "/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin"
  # Extra environment variables to run jobs from a file.
  # It will be ignored if it's empty or the file doesn't exist.
  env_file: {{ gitea_runner_home }}/.env
  # The timeout for a job to be finished.
  # Please note that the Gitea instance also has a timeout (3h by default) for the job.
  # So the job could be stopped by the Gitea instance if it's timeout is shorter than this.
  timeout: {{ gitea_runner_timeout | default('3h') }}
  # The timeout for the runner to wait for running jobs to finish when shutting down.
  # Any running jobs that haven't finished after this timeout will be cancelled.
  shutdown_timeout: 30s
  # Whether skip verifying the TLS certificate of the Gitea instance.
  insecure: false
  # The timeout for fetching the job from the Gitea instance.
  fetch_timeout: 5s
  # The interval for fetching the job from the Gitea instance.
  fetch_interval: 2s
  # The labels of a runner are used to determine which jobs the runner can run, and how to run them.
  # For host-based execution, use labels like: "self-hosted:host" or "linux:host"
  # For Docker-based execution, use labels like: "ubuntu-latest:docker://docker.gitea.com/runner-images:ubuntu-latest"
  # If it's empty when registering, it will ask for inputting labels.
  # If it's empty when execute `daemon`, will use labels in `.runner` file.
  labels:
{% for label in gitea_runner_labels.split(',') %}
    - "{{ label.strip() }}"
{% endfor %}

cache:
  # Enable cache server to use actions/cache.
  enabled: true
  # The directory to store the cache data.
  # If it's empty, the cache data will be stored in $HOME/.cache/actcache.
  dir: ""
  # The host of the cache server.
  # It's not for the address to listen, but the address to connect from job containers.
  # So 0.0.0.0 is a bad choice, leave it empty to detect automatically.
  host: ""
  # The port of the cache server.
  # 0 means to use a random available port.
  port: 0
  # The external cache server URL. Valid only when enable is true.
  # If it's specified, act_runner will use this URL as the ACTIONS_CACHE_URL rather than start a server by itself.
  # The URL should generally end with "/".
  external_server: ""

container:
{% if gitea_runner_use_docker_for_jobs | default(true) %}
  # Docker-based job execution configuration
  # Specifies the network to which the container will connect.
  # Could be host, bridge or the name of a custom network.
  network: "{{ gitea_runner_docker_network | default('bridge') }}"
  # Whether to use privileged mode or not when launching task containers (privileged mode is required for Docker-in-Docker).
  privileged: false
  # And other options to be used when the container is started (eg, --add-host=my.gitea.url:host-gateway).
  options: "--add-host=gitea.{{ domain }}:host-gateway"
  # The parent directory of a job's working directory.
  # NOTE: There is no need to add the first '/' of the path as act_runner will add it automatically.
  # If the path starts with '/', the '/' will be trimmed.
  # For example, if the parent directory is /path/to/my/dir, workdir_parent should be path/to/my/dir
  # If it's empty, /workspace will be used.
  workdir_parent: {{ gitea_runner_workdir_parent | default('workspace') }}
  # Volumes (including bind mounts) can be mounted to containers. Glob syntax is supported, see https://github.com/gobwas/glob
  # You can specify multiple volumes. If the sequence is empty, no volumes can be mounted.
  # Allow mounting workspace and common system paths for job execution
  valid_volumes:
    - "workspace/**"
    - "/tmp/**"
{% if gitea_runner_docker_volumes %}
{% for volume in gitea_runner_docker_volumes %}
    - "{{ volume }}"
{% endfor %}
{% endif %}
  # Use system Docker daemon for job containers
  # If it's empty, act_runner will find an available docker host automatically.
  docker_host: ""
  # Pull docker image(s) even if already present
  force_pull: {{ gitea_force_pull == 'always' | ternary('true', 'false') }}
  # Rebuild docker image(s) even if already present
  force_rebuild: false
{% else %}
  # Container execution disabled for host-based runners
  # Specifies the network to which the container will connect.
  # Could be host, bridge or the name of a custom network.
  # If it's empty, act_runner will create a network automatically.
  network: ""
  # Whether to use privileged mode or not when launching task containers (privileged mode is required for Docker-in-Docker).
  privileged: false
  # And other options to be used when the container is started (eg, --add-host=my.gitea.url:host-gateway).
  options:
  # The parent directory of a job's working directory.
  # NOTE: There is no need to add the first '/' of the path as act_runner will add it automatically.
  # If the path starts with '/', the '/' will be trimmed.
  # For example, if the parent directory is /path/to/my/dir, workdir_parent should be path/to/my/dir
  # If it's empty, /workspace will be used.
  workdir_parent:
  # Volumes (including bind mounts) can be mounted to containers. Glob syntax is supported, see https://github.com/gobwas/glob
  # You can specify multiple volumes. If the sequence is empty, no volumes can be mounted.
  # For example, if you only allow containers to mount the `data` volume and all the json files in `/src`, you should change the config to:
  # valid_volumes:
  #   - data
  #   - /src/*.json
  # If you want to allow any volume, please use the following configuration:
  # valid_volumes:
  #   - '**'
  valid_volumes: []
  # overrides the docker client host with the specified one.
  # For host-based runners, we set this to empty to disable Docker entirely
  # If it's empty, act_runner will find an available docker host automatically.
  # If it's "-", act_runner will find an available docker host automatically, but the docker host won't be mounted to the job containers and service containers.
  # If it's not empty or "-", the specified docker host will be used. An error will be returned if it doesn't work.
  docker_host: ""
  # Pull docker image(s) even if already present
  force_pull: false
  # Rebuild docker image(s) even if already present
  force_rebuild: false
{% endif %}

host:
  # The parent directory of a job's working directory.
  # If it's empty, $HOME/.cache/act/ will be used.
  workdir_parent: {{ gitea_runner_home }}/workspace
